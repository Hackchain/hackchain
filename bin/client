#!/usr/bin/env node
'use strict';

const hackchain = require('../');

const assert = require('assert');
const fs = require('fs');

const yargs = require('yargs')
    .usage('Usage: $0 --server ... --block <hash>\n' +
           '       $0 --server ... --tx <hash>\n' +
           '       $0 --server ... --spend example.tx')
    .alias('s', 'server')
    .describe('s', 'server address')
    .describe('block', 'block hash')
    .describe('tx', 'tx hash')
    .describe('spend', 'path to TX description')
    .demand([ 'server' ])
const argv = yargs.argv;

const client = new hackchain.Client(argv.server);

if (argv.block) {
  client.getBlock(argv.block, (err, block) => {
    if (err)
      throw err;

    console.log(block);
  });
  return;
}

if (argv.tx) {
  client.getTX(argv.tx, (err, tx) => {
    if (err)
      throw err;

    console.log(tx);
  });
  return;
}

if (argv.spend) {
  const text = fs.readFileSync(argv.spend).toString();
  client.parseTX(text, (err, tx) => {
    if (err)
      throw err;

    client.spendTX(tx, (err) => {
      if (err)
        throw err;

      console.log(tx);
    });
  });
  return;
}

yargs.showHelp();
